# 2부. 데이터 분석 준비하기

## 11. 데이터 전처리와 파생변수 생성
```
[목표]
* 데이터 전처리 방법
 - 결측값의 종류와 주요 처리 방법
 - 이상치의 판단 방법과 주요 처리 방법
 - 변수 구간화
 - 데이터 표준화와 스케일링
 - 파생변수 가공
 - 슬라이딩 윈도우 가공
 - 가변수 처리
 - 언더샘플링과 오버샘플링
 - 데이터 거리 측정 방법
```

### 11.1. 결측값 처리

결측값을 처리하기 전 데이터 탐색을 통해 결측값의 비율이 어떻게 되는지, 한 변수에 결측값이 몰려있지는 않은지 등을 파악해야 함. 어떤 경우에는 빈 문자열이 입력되어 있어 결측값으로 인식되지 않을수도 있기 때문에 확인해주어야 한다.

```
[결측치의 종류]

# MCAR 완전 무작위 결측: 순수하게 결측치가 무작위로 발생한 경우
# MAR 무작위 결측: 다른 변수의 특성에 의해 해당 변수의 결측치가 체계적으로 발생한 경우
# NMAR 비무작위 결측: 결측값들이 해당 변수 자체의 특성을 가짐
```

```
[결측치 처리 방법]

# 표본 제거 방법: 결측값이 심하게 많은 변수를 제거하거나 결측값이 포함된 행을 제외하고 데이터 분석을 진행하는 방법
  - 전체 데이터에서 결측값의 비율이 10% 미만인 경우 사용
  - MCAR이 아닌 경우 적절하지 않음

# 평균 대치법: 결측값을 제외한 온전한 값들의 평균을 구한 다음, 그 평균 값을 결측값들에 대치하는 방법
  - MCAR이 아닌 경우 적절하지 않음

# 보간법: 전 시점 혹은 다음 시점의 값으로 대치하거나 전 시점과 다음 시점의 평균값으로 대치하는 방법(단순보간), 결측치가 연달아 있는 경우나 시점 인덱스 간격이 불규칙한 경우에는 선형적 수치값을 계산해 보간함(시점고려보간).
  - 데이터가 시계열적 특성을 가진 경우 효과적

# 회귀대치법: 해당 변수와 다른 변수 사이의 관계성을 고려하여 결측값을 계산, 추정하고자 하는 결측값을 가진 변수를 종속변수로 하고 나머지 변수를 독립변수로 하여 추정한 회귀식을 통해 결측값을 대치
  - EX. '연령' 변수와 '연 수입' 변수 : 연 수입이 높으면 상대적으로 높은 연령을 추정하여 결측값을 대치
  - 결측된 변수의 분산을 과소 추정하는 문제 -> 인위적으로 회귀식에 확률 오차항을 추가하는 '확률적 회귀대치법'을 사용하여 변동성을 조정하기도 함.

# 다중 대치법: 단순대치를 여러 번 수행하여 N개의 가상적 데이터를 생성하여 이들의 평균으로 결측값을 대치하는 방법
  - 대치단계 -> 분석단계 -> 결합단계
  - 대치단계: MCMC 방법이나 MICE 방법을 사용하여 대치값을 임의로 생성, 5개 내외 정도만 생성해도 충분
  - 분석단계: 모수의 추정치와 표준오차 계산
  - 결합단계: 계산된 추정치와 표준오차를 결합하여 최종 결측 대치값 산출
```


### 11.2. 이상치 처리

이상치란 일부 관측치의 값이 전체 데이터의 범위에서 크게 벗어난 아주 작거나 큰 극단적인 값을 갖는 것을 말한다.

```
[이상치 처리를 해야 하는 이유]
- 데이터의 모집단 평균이나 총합을 추정하는 것에 문제를 일으킴
- 분산을 과도하게 증가시켜 분석이나 모델링의 정확도를 감소시킴
```

```
[이상치 처리 방법]
- 이상치를 결측값으로 대체한 다음 결측치 처리
- Trimming: 해당 이상치를 제거
- 관측값 변경: 하한값과 상한값을 정한 후 하한값보다 작으면 하한값으로, 상한값보다 크면 상한값으로 대체
- 가중치 조정: 이상치의 영향을 감소시키는 가중치를 부여

* 통계치를 통한 무조건적인 이상치 탐색은 위험할 수 있다.
  예를 들어 고객의 연령이 225세로 입력되어 있다면 이상치가 아니라 잘못 입력된 데이터인 것을 알고 삭제하면 된다.
  연봉 이상치가 나타나는 경우 분석 모델에 직종(사무직/전문직) 변수를 추가하여 회귀선의 정확도를 높일 수 있다.
```

### 11.3. 변수 구간화

변수 구간화(Binning): 데이터 분석 성능 향상 or 해석의 편리성을 위해 이산형 변수를 범주형 변수로 변환

```
[구간을 나누는 방법]
# 동일 폭으로 변수 구간화
# 동일 빈도로 변수 구간화
# ML 기법 : 클러스터링, 의사결정나무
-> IV값이 높을수록 종속변수의 True와 False를 잘 구분할 수 있는 정보량이 많다는 뜻(0.3보다 크면 예측력이 우수)

[평활화 방법]
# 구간별 평균값으로 평활화
# 구간별 중앙값으로 평활화
# 구간별 경곗값으로 평활화
```

### 11.4. 데이터 표준화와 정규화 스케일링

표준화, 정규화 스케일링: 독립변수들이 서로 단위가 다르거나 편차가 심할 때 값의 스케일을 일정한 수준으로 변환하는 것   
-> 머신러닝 모델의 학습 효율을 증가시키기 때문에 많이 사용

[표준화]   
**StandardScaler**   
각 관측치의 값이 전체 평균을 기준으로 어느 정도 떨어져 있는지 나타낼 때 사용
$$z = {x-\mu\over σ}$$

[정규화]   
**MinMaxScaler**    
데이터의 범위를 0부터 1까지로 변환하여 데이터 분포를 조정하는 방법
$$x_{scaled}={x-x_{min}\over x_{max}-x_{min}}$$

[RoburtScaler]   
표준화와 정규화는 이상치에 민감하다는 단점을 보완한 스케일링 기법   
평균대신 중앙값을 사용

### 11.5. 모델 성능 향상을 위한 파생 변수 생성



### 11.6. 슬라이딩 윈도우 데이터 가공

### 11.7. 범주형 변수의 가변수 처리

### 11.8. 클래스 불균형 문제 해결을 위한 언더샘플링과 오버샘플링

### 11.9. 데이터 거리 측정 방법