# 2부. 데이터 분석 준비하기

## 08. 분석 프로젝트 준비 및 기획
```
[목표]
* 데이터 분석의 프로세스 익히기
* 비즈니스 문제 정의와 분석 목적 도출 방법 알아보기
* 외부 데이터를 수집하는 데이터 구매, 오픈 데이터 수집, 크롤링 방법 알아보기
```
### 8.1. 데이터 분석의 전체 프로세스

```
[데이터 분석 3단계]
목표: 의사결정 프로세스 최적화하기

설계 > 분석 및 모델링 > 구축 및 활용

# 설계: 과제 정의 및 범위 설정

# 분석 및 모델링: 외부 데이터 수집 및 전처리, 데이터 분석 및 모델 도출, 모델 검증

# 구축 및 활용 단계: 모델 적용, 성과 평가
```
[분석 및 모델링 단계에서의 여러가지 방법론]
1. CRISP-DM 방법론

<img src="../img/2.1.jpg" width= 70% style="display: block; margin: auto;">
<br>

목표, 계획 수립 > 데이터 이해 > 데이터 준비 > 모델링 > 평가 > 보고 및 검토

2. SAS SEMMA 방법론

```
S(ampling): 데이터 추출

E(xploration): 데이터 탐색
-> 시각화로 데이터 탐색
-> 상관분석, 클러스터링 등을 통해 변수 관계 파악
-> 분석 모델에 적합한 변수 설정

M(odification): 변수 가공
-> 결측치 처리 및 최종 분석 변수 선정
-> 로그변환, 구간화 등 데이터 가공
-> PCA 등을 통해 새로운 변수 생성

M(odeling): 모델 구축

A(ssessment): 모델 평가
```

전체 과정은 무조건 단방향으로 진행되지 않음. 상황에 따라 왔다 갔다..

### 8.2. 비즈니스 문제 정의와 분석 목적 도출

데이터를 살펴보다 운 좋게 의미 있는 정보를 찾게 되어 성과를 낸다면 다행이겠지만, 목적이 불명확하다면 대부분 제대로 된 성과를 내지 못한다.

비즈니스 이해 및 문제 정의가 조금이라도 잘못되면 최종 인사이트 도출 및 솔루션 적용 단계에서 제대로 된 효과를 보기 힘들다. 심한 경우, 후반부에 와서 왜 이 프로젝트를 하는지 목적이 불분명해지기도 한다.

<br>
<img src="../img/2.2.jpg" width= 70% style="display: block; margin: auto;">
<br>

비즈니스 문제를 올바르게 정의하기 위한 논리적 접근법으로 가장 널리 쓰이는 방식이 MECE다. 이는 세부 정의들이 서로 겹치지 않고 전체를 합쳤을 때는 빠진 것 없이 완전히 전체를 이루는 것을 의미한다.

그렇다면 비즈니스 문제와 목적은 어떻게 해야 잘 정의할 수 있을까? 비즈니스 문제는 `현상에 대한 설명으로 끝나서는 안되고, 본질적인 문제점이 함께 전달`되어야 한다.

<br>
<img src="../img/2.3.jpg" width= 70% style="display: block; margin: auto;">
<br>

비즈니스 문제를 고객 이탈로 시작하는 경우, 이탈 고객 예측 모델을 만들게 된다. 반면 비즈니스 문제를 고객 이탈에 따른 수익 감소로 정의하는 경우, 프로모션 최적화 모델을 만들게 된다. 즉, `본질적인 문제를 명시`해야 제대로된 분석이 진행될 수 있다.

### 8.3. 분석 목적의 전환

분석 프로젝트는 데이터 탐색을 하기 전까지 데이터에 숨겨져 있는 정보와 인사이트를 확인하기 어렵다. 따라서 분석 프로젝트의 방향이 언제든 바뀔 수 있다는 것을 염두에 두어야 한다.

```
[필자의 경험 예시]
원재료 정제 필터 적정 교체시기 예측 모델 구축 프로젝트 진행
필터 교체와 절사 발생률 간 관계를 찾을 수 없었음.
분석 목적을 전환하여 원사 절사 개선 프로젝트로 바꿈.

=> 실무자들 간 커뮤니케이션 및 협력이 매우 중요
# 팁: 시각화 적극 활용하기
      단순한 데이터라도 시각화하여 실무자와 공유하고 그들과의 신뢰를 쌓는 것이 중요함.
```

### 8.4. 도메인 지식

```
[기업이 DA 역량을 기르기 위한 인력 충원 방법]

1. 데이터 분석가를 새로 고용 -> 시간, 비용 절약

2. 기존 실무자나 신입사원을 교육시켜 데이터 분석가로 만듦 -> 도메인 지식이 충분한 DA 양성 가능
```

```
# 도메인 지식: 업에 대한 이해도

도메인 지식이 없다면 문제 정의와 분석 목적이 1차원적일 수밖에 없다. 또한 분석 결과가 어떠한 의미를 가지는지, 어떻게 활용될 수 있는지 알기 힘들다.

ex. 배달앱에서 '국밥' 키워드 검색의 노출 순위 최적화
- 도메인 지식 x : 고객 성별, 연령 등을 기준으로 군집화하여 인기 있는 순으로 노출
- 도메인 지식 o : 지역별로 '국밥'하면 떠오르는 국밥의 종류가 다르기 때문에 지역별로 노출되는 국밥의 종류를 다르게 할 수 있음.

[도메인 지식을 효과적으로 습득하려면?]
1. 프로젝트 초반에 실무자와 잦은 미팅과 함꼐 적극적인 질문과 자료 요청을 할 것
2. 관련 논문들을 참고하여 해당 도메인에 대한 심도 있는 지식 습득하기
3. 현장에 방문에 데이터가 만들어지는 과정을 직접 보기, 어렵다면 실제 공정과 유사한 동영상을 요청하거나 유튜브 영상 검색
=> 데이터가 생성되는 현장을 직접 보고 소비자 혹은 사용자의 입장에 되어 경험을 해보는 것이 좋음.
```

### 8.5. 외부 데이터 수집과 크롤링

외부 데이터를 수집하기 위해서는 많은 시간과 비용, 노력이 소요되므로 데이터를 수집하기 전에 분석 목적을 명확히 정의해야 한다.

```
# 외부 데이터 수집: 정형, 반정형, 비정형 등 다양한 유형의 데이터를 수집

일반적으로 다수의 경로에서 다양한 데이터를 한꺼번에 수집한 다음
머신러닝 모델이나 분석 목적에 맞도록 통합, 가공 후 비즈니스에 활용

## 방법
1. 데이터 구매
2. 오픈 데이터 수집
3. 크롤링
: 해당 웹페이지가 리뉴얼되면 이제 맞춰 수집 코드를 수정해야 함
: 일반적으로 웹사이트에서는 robots.txt 파일을 심어 두어 접속 주체에 따라 크롤링 허용 범위를 안내하고 있다.
(대상 크롤러 / 허용 경로 / 허용하지 않는 경로)에 대한 정보를 포함.

* 스크래핑: 크롤링과 달리 웹 페이지에서 자신이 원하는 부분의 정보만 가져오는 것
```

```
[크롤링]
3-1. open api를 통해 정리된 데이터 제공받기
3-2. 직접 코딩
3-3. 파이썬에서는 BeautifulSoup나 Selenium 라이브러리 활용 가능

크롤링: 웹사이트의 html 구조를 활용하여 원하는 데이터가 있는 위치를 사전에 설정하여 자동으로 반복적으로 특정 위치에 있는 텍스트를 수집하는 것

크롬 브라우저에서 F12키를 누르면 개발자도구 열림
> 원하는 위치에 마우스 커서를 가져다 대면 해당 영역의 소스 코드가 노출됨
(수집하고자 하는 데이터의 구조적 위치를 확인)
> 복사된 위치를 파이썬 코드에 삽입하여 해당 위치의 텍스트를 수집
```

```
[크롤링 코드 연습]
```



## 09. 분석 환경 세팅하기
```
[목표]
* SAS, R, 파이썬 등 데이터 분석 프로그래밍 언어의 특징을 알아보고 전체적인 데이터 처리 프로세스를 알아본다.
* 분산 데이터 처리 방식: HDFS, 아파치 스파크
* 테이블 조인, 데이터 단어사전, 테이블 정의서, ERD
```
### 9.1. 어떤 데이터 분석 언어를 사용하는 것이 좋을까?

```
# SPSS: 사회과학 통계프로그램 -> 대학 논문 작성 시 많이 사용

# SAS: 정확성이 중요한 금융업계 기업이 많이 사용
       기업의 데이터 환경에 맞게 커스텀 가능
       데이터 시각화가 용이
       딥러닝, 인공신경망 분석은 약하기 때문에 최근에는 R과 SAS 환경에서도 사용할 수 있도록 지원

# R: 오픈소스 데이터 분석용 언어
     통계적 기능이 우수
     데이터 시각화 특화

# 파이썬: C 언어로 구현된 프로그래밍 언어
         데이터 분석 뿐만 아니라 웹서비스, 응용 프로그램, IoT 등 다양한 분야에서 사용
         C보다 쉽고 간단하지만 느림

# SQL: 관계형 데이터베이스 시스템에서 데이터를 관리 및 처리하기 위해 설계된 언어
       대화식 언어

데이터 전처리 -> SQL, 파이썬
ML 모델 -> 파이썬의 sklearn 등의 패키지 활용
```
<img src="../img/2.4.jpg" width= 100% style="display: block; margin: auto;">
<br>

### 9.2. 데이터 처리 프로세스 이해하기

데이터 분석가는 데이터 분석 역량뿐만 아니라 데이터베이스 서버 환경에 대해서도 어느 정도 알고 있어야 한다. 그래야 효율적으로 데이터를 끌어오고 가공하여 분석할 수 있다.

```
[일반적인 데이터 처리 프로세스]
OLTP -> DW(ODS) -> DM -> OLAP

# OLTP: 데이터가 생성되고 저장되는 처음 단계

# DW: 데이터 창고, 전체 히스토리 데이터 보관
## ODS:  데이터를 DW에 저장하기 전에 임시로 데이터를 보관하는 중간 단계의 저장소, 최신 데이터를 반영

# DM: 사용자의 목적에 맞도록 가공된 일부의 데이터가 저장되는 곳, DW의 시스템 부하를 감소

# OLAP

## ETL: 데이터의 추출, 변환, 불러내기
```

### 9.3. 분산데이터 처리 -> 넘어가기

```
분산 데이터 처리: 한 컴퓨터가 처리해야 할 일을 여러 컴퓨터가 나눠서 한 다음 그 결과를 합치는 것

[빅데이터 처리를 위한 방식]
- scale-up: 컴퓨터의 용량을 늘리고 더 빠른 프로세서를 탑재
- scale-out: 여러 대의 컴퓨터를 병렬적으로 연결하는 방식 -> 효율적!
```

하지만 무조건 컴퓨터를 병렬적으로 연결한다고 해서 데이터 처리가 빨라진다고 할 수는 없다. 연결된 컴퓨터들이 효율적으로 데이터를 나눠서 처리하고 결과를 취합할 수 있어야 한다. => `HDFS`, `맵리듀스`

```
[HDFS의 모듈]
# 슬레이브 노드: 데이터를 저장하고 계산
# 마스터 노드: 대량의 데이터를 HDFS에 저장하고 맵리듀스 방식을 통해 데이터를 병렬 처리
# 클라이언트 머신: 맵리듀스 작업을 통해 산출된 결과를 사용자에게 보여줌
```

### 9.4. 테이블 조인과 정의서 그리고 ERD

데이터분석가는 한 개의 테이블만을 활용하는 경우가 거의 없다. 적어도 3개 이상의 테이블을 조합하고 새로 가공하면서 인사이트를 찾아내야 한다. 그러므로 각 테이블의 속성과 테이블 간의 관계를 명확히 인지하고 있어야 한다.

#### 9.4.1. 테이블 조인
```
# INNER JOIN
: 두 테이블에서 공통된 값이 존재하는 행만 결합.

# LEFT JOIN
: 왼쪽(기준) 테이블의 모든 행을 포함하고, 오른쪽 테이블에 일치하는 값이 없으면 NULL로 채움.

# RIGHT JOIN
: 오른쪽(기준) 테이블의 모든 행을 포함하고, 왼쪽 테이블에 일치하는 값이 없으면 NULL로 채움.

# FULL JOIN
: LEFT JOIN + RIGHT JOIN
: 두 테이블에서 모든 데이터를 포함하고, 일치하지 않는 데이터는 NULL로 채움.

# CROSS JOIN
: 모든 가능한 조합을 생성하는 JOIN 방식입니다.
: 결과 행의 수 = 첫 번째 테이블의 행 수 × 두 번째 테이블의 행 수
```

#### 9.4.4. ERD
```
ERD: 각 테이블의 구성 정보와 테이블 간 관계를 도식화

테이블은 entity라고 불리며
각 테이블이 어떤 테이블과 어떤 키로 연결되어 있는지 직관적으로 확인할 수 있다.

물리와 논리로 구분됨
물리: 영문, DB를 효율적이고 결점없이 구현
논리: 한글, 사용자 입장에서 테이블 간 매핑에 오류가 없으며 데이터의 정규화가 이루어진 ERD 개념
-> DA는 논리 ERD를 보고 DB 구조 파악

[key, 식별자]
# key
## 기본키(PK): 테이블에 적재된 각각의 데이터를 *유일하게 구분*하는 키
- 중복x, 결측치x
## 외래키(FK): 각 테이블 간 *연결*을 만들기 위해 테이블에서 다른 테이블의 참조되는 기본 키
```
<img src="../img/2.5.jpg" width= 100% style="display: block; margin: auto;">
<br>